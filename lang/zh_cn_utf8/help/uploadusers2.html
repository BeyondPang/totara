<h1>上传用户</h1>

<p>首先，请注意<strong>通常都没有必要大批量上传用户</strong> - 要保持您自己的维护工作顺利进行，首先应当看一下是否有合适的无需手工维护的认证方法，如连接到现有外部数据库或让用户自己创建他们的帐号。请参阅管理菜单中的认证部分。</p>
<p>如果您确定要从文本文件中导入多个用户账户，您需要按以下格式保存您的文本：</p>

<ul>
<li>文件中的每一行都包含一条记录</li>
<li>每条记录都是一系列以逗号(或其他定义符号)分隔的数据</li>
<li>文件的第一条记录很特殊，它包含着字段名的列表。 此记录定义了文件中其他部分的格式。
    <blockquote>
<p><strong>必填字段名：</strong>这些字段必须包含在第一条记录中，并且要为每个用户定义</p>
<p><code>firstname, lastname</code> （插入记录时）或者 <code>username</code> （更新记录时）</p>
<p><strong>可选字段名：</strong> 所有这些都是可选的。如果文件中为此字段提供了一个值，则可以直接采用，否则将使用该字段的默认值。</p>
<p><code>institution, department, city, country, lang, auth, ajax, timezone, idnumber, icq, phone1, phone2, address, url, description, mailformat, maildisplay, htmleditor, autosubscribe, emailstop</code></p>
<p><strong>自定义配置文件字段名：</strong>可选， xxxxx 是真实的自定义用户配置文件字段名（即唯一简称）</p>
<p><code>profile_field_xxxxx</code></p>
<p><strong>特殊字段名：</strong>用于更改用户名和删除用户，请参见以下内容</p>
<p><code>deleted, oldusername</code></p>
<p><strong>输入字段名（可选）：</strong>课程名称是这些课程的&ldquo;简称&rdquo;（如果存在），然后用户就可以登录这些课程了。&ldquo;类型&rdquo;是指用于登录相关课程的角色类型。值 1 是默认的课程角色，2 是原有的教师角色，3 是原有的无编辑权限的教师角色。您无需直接指定角色而可以使用角色字段来指定 - 使用角色简称或 ID（不支持角色的数字名称）。在课程中用户也可能被分成小组（小组 1 在课程 1 中，小组 2 在课程 2 中等等）。小组也通过其名称或 ID 进行标识（不支持小组的数字名称）。</p>
<p><code>course1、type1、role1、group1、course2、type2、role2、group2 等等。</code></p>
    </blockquote>
    </li>
<li>数据中的逗号应当编码为 &amp;#44 - 脚本会自动将它们解码为逗号。</li>
<li>对于布尔字段，用 0 表示 false、1 表示 true。 </li>
</ul>
<p>下例是一个有效的导入文件：</p>
<p><code>username, password, firstname, lastname, email, lang, idnumber, maildisplay, course1, group1, type1<br /> jonest, verysecret, Tom, Jones, jonest@someplace.edu, en, 3663737, 1, Intro101, Section 1, 1<br /> reznort, somesecret, Trent, Reznor, reznort@someplace.edu, en_us, 6736733, 0, Advanced202, Section 3, 3</code></p>

<h2>模板</h2>
<p>下列代码可以用于处理默认值以作为模板：</p>
<ul>
<li><code>%l</code> - 将被&ldquo;lastname&rdquo;替换</li>
<li><code>%f</code> - 将被&ldquo;firstname&rdquo;替换</li>
<li><code>%u</code> - 将被&ldquo;username&rdquo;替换</li>
<li><code>%%</code> -将被&ldquo;%&rdquo;替换</li>
</ul>
<p>百分号 (%) 与任意代码字母(l、f 或 u）之间可存在以下修饰符：</p>
<ul>
<li>(-) 减号符号--代码字母所指定的信息将转换为小写字母</li>
<li>(+) 加号符号--代码字母所指定的信息将转换为大写字母</li>
<li>(~) 波浪线符号 - 代码字母所指定的信息将转换为首字母大写</li>
<li>小数 - 代码字母所指定的信息将被截断为多个字符</li>
</ul>

<p>例如，如果名是 John，姓是 Doe，可使用指定的模板获取以下值：</p>
<ul>
<li>%l%f = DoeJohn</li>
<li>%l%1f = DoeJ</li>
<li>%-l%+f = doeJOHN</li>
<li>%-f_%-l = john_doe</li>
<li>http://www.example.com/~%u/ = http://www.example.com/~jdoe/ (如果 username 是 jdoe or %-1f%-l)</li>
</ul>
<p>只能在默认值下处理模板, 而不能使用从 CSV 文件获得的值。</p>
<p>为了创建正确的 Moodle 用户名，用户名总是被转换为小写字母。此外，如果关闭站点策略页面上的&ldquo;允许在用户名中使用拓展字符&rdquo;选项，则将移除不同于字母、数字、破折号 (-)、点 (.) 的符号。如果名字是 John Jr. 并且姓为 Doe, 用户名 %-f_%-l ，在允许用户名使用扩展字符的情况下，将出现 john jr._doe , 反之则为 johnjr.doe 。</p>
<p>当&ldquo;处理重复的新用户名&rdquo;设置被设置在附加计数器上，那么自动递增的计数将附加到模板生成的&ldquo;重复的用户名&rdquo;。例如，如果 CSV 文件中包含名为 John Doe、Jane Doe 和 Jenny Doe 一类没有明确用户名的用户，那么默认的用户名是 %-1f%-l ，并且&ldquo;处理重复的新用户名&rdquo;设置为附加计数器，产生的用户名为：jdoe, jdoe2 and jdoe3。
</p>

<h2>更新现有帐户</h2>

<p>默认情况下，Moodle 会假设您将要创建新的用户帐户，并在用户名与现有账户匹配时跳过记录。然而，如果您选择&ldquo;更新已有帐户&rdquo;，则已有的用户帐户会被更新。 </p>

<p>在更新现有帐户时，您也可以修改用户名。将&ldquo;允许重命名&rdquo;设置为<b>是</b>，并将名为 <font color="#990000" face="Courier New, Courier, mono">oldusername </font> 的字段包含在您的文件中。</p>

<p><b>警告：</b>更新现有帐户时出现任何错误都会严重影响您的用户。使用选项更新时,请务必小心。</p>

<h2>删除帐户</h2>
<p>如果显示<code>已删除</code>字段，则将删除值为 1 的用户。在这种情况下，可能省略了所有字段，<code>username</code> 除外。</p>
<p>可以使用单个 CSV 文件删除和上传帐户。例如，下面的文件中将添加用户 Tome Jones 并删除用户 reznort：</p>
<p><code>username, firstname, lastname, deleted<br /> jonest, Tom, Jones, 0<br /> reznort, , , 1</code></p>
